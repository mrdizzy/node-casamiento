<html>
<head>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.0/jquery-1.8.0.min.js" type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>

<script type="text/template" id="add_image_form">
    <p>Thumb: <input type="file" name="thumb-{{counter}}"></input></p>       
    <p>Display: <input type="file" name="display-{{counter}}"></input></p>    
    <p>Medium: <input type="file" name="medium-{{counter}}"></input></p>    
    <p>Large: <input type="file" name="large-{{counter}}"></input></p>
      
    <p class="remove">Remove</p>
</script>


<script type="text/javascript">
_.templateSettings = {
  interpolate : /\{\{(.+?)\}\}/g
};

$(function() {
    var Counter = Backbone.Model.extend({
        defaults: {
            value: 0
        }
        });
        var counter = new Counter();
        
    var ImageFormView = Backbone.View.extend({
            events: {
            'click .remove': 'destroy'
        },
        destroy: function() {
            this.remove();
        },
        render: function() {
               var template = $('#add_image_form').html(),               
               compiled = _.template(template, { counter: this.model.get("value")});
              this.$el.html(compiled);
               return this;
        }
    })
    var MainForm = Backbone.View.extend({
        el: 'form',
        events: {
            'click #add_image': 'addImageForm'   
        },
        addImageForm: function() {
            this.model.set("value", this.model.get("value") + 1);
            new ImageFormView({model: counter}).render().$el.insertAfter(this.$('#add_image'))
        }
        
    })
    new MainForm({model: counter });
});
</script>
</head>
<body>

<form id="new_product" action="/admin/products" method="POST" enctype="multipart/form-data">

<p>
Theme:
<select name="theme">
<% themes.forEach(function(theme) { %>
<option value="<%= theme%>"><%= theme %></option>
<% }) %>
</select>
</p>

<p>
Product Type:
<select name="product_type">
<% product_types.forEach(function(type) { %>
<option value="<%= type %>"><%= type %></option>
<% }) %>
</select>
</p>
<p id="add_image">Add Image</p>
<input type="submit"></input>
</form>
</body>
</html>