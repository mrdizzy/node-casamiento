<!doctype html>
<html>
<head>

    <meta name="viewport" content="initial-scale=1, user-scalable=no">
    
<style type="text/css">
.dizzycp-static_container { border:1px solid transparent; border-bottom:0;background-color:white;}
.dizzycp-swatch_container { text-align:center;}
.dizzycp-big_colour_square_frame { cursor:pointer; display:inline-block; border:1px solid lightgrey; width:40px; height:40px; padding:2px; border-radius:25px;}
.dizzycp-big_colour_square_swatch { width:36px; height:36px;margin:2px; border-radius:20px;}
.dizzycp-text_label_for_colour { color:black;padding-top:0.25em;padding-bottom:0.25em;font:normal 1.2em 'OS';text-transform:uppercase;letter-spacing:0.05em;}

.dizzycp-container_to_fade_in {width:100%;background-color:white;display:none; position:absolute; border:1px solid transparent;border-top:0;z-index:1;}

.dizzycp-selected { border: 1px solid black;}
.dizzycp-container_selected { border-color:black;border-style:dotted}

</style>
<style type="text/css">

#arrow_left, #arrow_right {
  font-size:30px;
  float:left;
}
.dizzycp-external_wrapper {
  margin:0 auto;
  margin-top:10px;
  height:50px;
  width:300px;
  overflow:hidden;
}
.dizzycp-left_arrow { margin-left:50px;}

.dizzycp-right_arrow { margin-right:50px;}
.dizzycp-internal_wrapper{
  width:300px;
  height:150px
  overflow-y: hidden;
  overflow-x: scroll
}
.square { 
  float:left;
  width:50px;
  height:50px;
}
.dizzycp-scrollable_colours {
  height:100px;
  position:relative;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>    
<script src="/javascripts/libraries/in_groups_of.js"></script>    
<script src="colours.js"></script>    
</head>

<body>

<div id="new_colour_picker"></div>

</body>

<script>
;(function($) {

  $.fn.colorPicker = function(options) {
 var that = this;
  var settings = $.extend({},  $.fn.colorPicker.defaultOptions, options);
  var colour_groups = inGroupsOf(Object.keys(settings.colour_list), settings.colours_per_page)

  var pairs = _.pairs(colours)
  var groups = inGroupsOf(pairs, 6)

 //static container
  var $static_container = $('<div></div>').addClass('dizzycp-static_container')
  var $text_label_for_colour = $('<div>' + settings.colour_list[settings.default_color] + '</div>').addClass("dizzycp-text_label_for_colour")
  var $big_colour_square_frame = $('<div></div>').addClass('dizzycp-big_colour_square_frame')
  var $big_colour_square_swatch = $('<div></div>').css("background-color", settings.default_color).addClass('dizzycp-big_colour_square_swatch')
  
  $big_colour_square_frame.append($big_colour_square_swatch)
  var $swatch = $('<div></div>').addClass("dizzycp-swatch_container")
  $swatch.append($big_colour_square_frame).append($text_label_for_colour)   
    
  var number_of_colours = pairs.length;
  var width_of_inside = 50 * number_of_colours;
  
  var $external_wrapper = $('<div></div>').addClass('dizzycp-external_wrapper');
  var $internal_wrapper = $('<div></div>').addClass('dizzycp-internal_wrapper')
  var $scrollable_colours = $('<div></div>').addClass('dizzycp-scrollable_colours').css("width",width_of_inside + "px");
  $internal_wrapper.append($scrollable_colours)
  $external_wrapper.append($internal_wrapper)
  
  var counter = 0;
  var colour_divs = []
  
  groups.forEach(function(group) {
    var $colour_div = $('<div id="panel_' + counter + '" style="float:left"></div>');
    group.forEach(function(colour) {
      $colour_div.append('<div data-colour="' + colour[0] + '" style="background-color:' + colour[0] + '" class="square"></div>');
    })
    colour_divs.push($colour_div)
    counter = counter + 1;
  })
    
  $scrollable_colours.html(colour_divs)
   
  // container to fade in
  var $container_to_fade_in = $static_container.clone().addClass("dizzycp-container_to_fade_in")

  $container_to_fade_in.append($external_wrapper)
  
  $container_to_fade_in.find('.square').mouseenter(function(e) {
    var $el = $(e.currentTarget);
    var hex = $el.data("colour");
    $text_label_for_colour.text(colours[hex])
    $big_colour_square_swatch.css("background-color", hex)
  })
  
  // compile containers
  $static_container.append($swatch)

  var new_counter = 0;
  
  var $wrapper = $('<div></div>').append($static_container).append($container_to_fade_in)
  $wrapper.css("position", "relative")
  
  // Arrows 
  $left_arrow = $('<div class="dizzycp-left_arrow"style="float:left;font-size:50px;">&laquo;</div>').click(function() {
    scrollColours(-1)
  });
  $right_arrow = $('<div  class="dizzycp-right_arrow" style="float:right;font-size:50px;">&raquo;</div>').click(function() {
    scrollColours(1)
  });;
  $container_to_fade_in.append($left_arrow).append($right_arrow)
  
     // Enter big swatch    
  $big_colour_square_frame.mouseenter(function() {   
      $static_container.addClass("dizzycp-container_selected")
      $container_to_fade_in.addClass("dizzycp-container_selected")
        $container_to_fade_in.fadeIn();
  })
    
    // Leave wrapper
  $wrapper.mouseleave(function() {  
    $static_container.removeClass("dizzycp-container_selected")
    $container_to_fade_in.removeClass("dizzycp-container_selected")  
    $container_to_fade_in.fadeOut();
  })   
  this.html($wrapper)

  function scrollColours(amount) {
    new_counter = new_counter + amount;  
    console.log($container_to_fade_in.find('#panel_' + new_counter).position())
    var position = $container_to_fade_in.find('#panel_' + new_counter).position().left;  
    $internal_wrapper.animate({scrollLeft: position}, 100);
  }
  return this;
}

$.fn.colorPicker.defaultOptions ={
  colours_per_page: 16,
  colour_list: colours,
  default_color: '#cd5c5c'
} 
      
})(jQuery)

$('#new_colour_picker').colorPicker();
</script>
</html>

