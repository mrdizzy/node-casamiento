<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.5.0-dev/mustache.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>
<script type="text/template" id="table">
        <tr>
            <th>Date</th>
            <th>Name</th>
            <th>payer ID</th>
            <th>Email</th>
            <th>Memo</th>
            <th>Items</th>
            <th>Amount</th>
        </tr>
</script>
<script type="text/template" id="row">
    <td>{{date}}</td>
    <td>{{address}}</td>
    <td><input type="checkbox" value="{{payer_id}}" />{{payer_id}}</td>
    <td>{{email}}</td>
    <td>{{note}}</td>
    <td>
        {{#items}}
            {{L_QTY}} {{L_AMT}} {{L_NUMBER}} {{item.L_NAME}}<br/>
        {{/items}}
    </td>
    <td>{{amount}}</td>
</script>

<script type="text/javascript">

var Transaction = Backbone.Model.extend();

var Transactions = Backbone.Collection.extend({
    model: Transaction,
    url: '/paypalrecent'
})

var transactions = new Transactions();
transactions.fetch({
    success: function(collection, response) {
        console.log(collection, response);
    },
    error: function(collection, response) {
        console.log(collection, response)
    }
});
var TransactionView = Backbone.View.extend({
    tagName: 'tr',
    initialize: function() {
        this.model.bind('change', this.render, this);
    },
    render: function() {
        var row = Mustache.render($('#row').html(), this.model.toJSON());
        this.$el.html(row);
        return this;
    }
})

var TransactionsView = Backbone.View.extend({
    initialize: function() {
        this.collection.bind('reset', this.render, this);  
    },
    tagName: 'table',
    render: function() {  
       
        this.$el.html(Mustache.render($('#table').html()));

        var rows = []
        this.collection.forEach(function(t) {
            var row = new TransactionView({model: t}).render().el;      
            rows.push(row);
        });
        $('tr', this.$el).after(rows);
        return this;
    }
});

$(function() {
   var tv = new TransactionsView({collection:transactions});    
   $('#transactions').html(tv.render().el);
})

</script>
<style type="text/css">
</style>
</head>

<body>
<div id="transactions">

</div>
<input type="submit" id="parse"></input>
</body>
</html>