{"filter":false,"title":"products.js","tooltip":"/controllers/products.js","undoManager":{"mark":0,"position":-1,"stack":[[{"start":{"row":124,"column":0},"end":{"row":179,"column":0},"action":"remove","lines":["","exports.update = exports.create = function(req, res) {","","  if (req.product) {","    var rev = req.product.rev,","      id = req.product.id;","    req.body._rev = rev;","  }","  else {","    var id = req.body._id","  }","  //var svg = req.body.svg.toString() is used to \"copy\" the string as we are about to delete it in the next line","  if (req.body.svg) {","    var svg = req.body.svg.toString();","    delete req[\"body\"].svg;","  }","  db.save(id, rev, req.body, function(err, documents) {","    console.log(err, documents)","    var new_product = req.body;","    new_product._rev = documents.rev;","    if (err) {","      console.log(\"Unable to save main document\", err, documents)","      res.status(500);","      res.end();","    }","    else {","      if (svg) {","        var svg_id = \"svg__\" + documents.id;","        db.get(svg_id, function(e, record) {","          if (record) var svg_rev = record._rev;","          db.save(svg_id, svg_rev, {","            _attachments: {","              svg: {","                'Content-Type': \"image/xml+svgz\",","                data: svg","              }","            }","          }, function(anerror, done) {","            if (anerror) {","              console.log(\"Error saving attachment of SVG\", anerror)","              res.status(500);","              res.end();","            }","            else {","              res.json(new_product)","            }","          })","        })","      }","      else {","        res.json(new_product)","      }","    }","  });","}",""],"id":2}]]},"ace":{"folds":[],"scrolltop":2254.5,"scrollleft":0,"selection":{"start":{"row":124,"column":0},"end":{"row":179,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1446400346134,"hash":"56fd1f25268a70eaf706bcb76462dee86bca3dfa"}