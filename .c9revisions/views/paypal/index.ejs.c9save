{"ts":1351449381982,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<html>\n<body>\n<head>\n<style type=\"text/css\">\nbody { text-align:left; }\ntable { border-collapse:collapse;text-align:left;}\ntd { border: 1px solid grey; text-align:left;}\n</style>\n</head>\n<table>\n<tr>\n<th>\nDate\n</th>\n<th>\nName\n</th>\n<th>\npayer ID</th>\n<th>\nEmail\n</th>\n<th>\nMemo</th><th>\nItems</th>\n<th>\nAmount</th>\n</tr>\n\n<% transactions.forEach(function(t) { %>\n<tr>\n<td>\n<%= t.date %></td>\n<td>\n<%= t.address %>\n</td>\n<td><input type=\"checkbox\" value=\"<%=t.payer_id%>\" />\n<%= t.payer_id %>\n</td>\n<td>\n<%= t.email %>\n</td><td>\n<%= t.note %>\n</td>\n\n<td>\n<% t.items.forEach(function(item) { %>\n<%= item.L_QTY %> <%= item.L_AMT %> <%= item.L_NUMBER %> <%= item.L_NAME %><br/>\n<% }) %>\n</td>\n<td>\n<%= t.amount %>\n</td>\n</tr>\n<% }) %>\n</table>\n</body>\n</html>"]],"start1":0,"start2":0,"length1":0,"length2":754}]],"length":754}
{"contributors":[],"silentsave":false,"ts":1351449434062,"patch":[[{"diffs":[[0,"tml>"],[-1,"\n<body>\n<head>\n<style type=\"text/css\">\nbody { text-align:left; }\ntable { border-collapse:collapse;text-align:left;}\ntd { border: 1px solid grey; text-align:left;}\n</style>\n</head>\n<table>\n<tr>\n<th>\nDate\n</th>\n<th>\nName\n</th>\n<th>\npayer ID</th>\n<th>\nEmail\n</th>\n<th>\nMemo</th><th>\nItems</th>\n<th>\nAmount</th>\n</tr>\n\n<% transactions.forEach(function(t) { %>\n<tr>\n<td>\n<%= t.date %></td>\n<td>\n<%= t.address %>\n</td>\n<td><input type=\"checkbox\" value=\"<%=t.payer_id%>\" />\n<%= t.payer_id %>\n</td>\n<td>\n<%= t.email %>\n</td><td>\n<%= t.note %>\n</td>\n\n<td>\n<% t.items.forEach(function(item) { %>\n<%= item.L_QTY %> <%= item.L_AMT %> <%= item.L_NUMBER %> <%= item.L_NAME %><br/>\n<% }) %>\n</td>\n<td>\n<%= t.amount %>\n</td>\n</tr>\n<% }) %>\n</table>\n</body>"],[1,"\r\n<head>\r\n<script src=\"http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js\"></script>\r\n<script src=\"http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js\"></script>\r\n<script src=\"http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.0.beta6/handlebars.min.js\"></script>\r\n<script src=\"http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js\"></script>\r\n\r\n<script type=\"text/javascript\">\r\n\r\nHandlebars.registerHelper(\"each_with_index\", function(array, start, fn) {\r\n    var buffer = \"\";\r\n    for (var i = 0, j = array.length; i < j; i++) {\r\n\t\tvar item = array[i];\r\n\t\titem.index = start +i+1; // stick an index property onto the item, starting with 1, may make configurable later\r\n\t\tbuffer += fn(item); // show the inside of the block\r\n\t}\r\n\treturn buffer; // return the finished buffer\r\n});\r\n\r\nHandlebars.registerHelper(\"each_item\", function(array, start, fn) {\r\n    var buffer = \"\";\r\n    for (var i = 0, j = array.length; i < j; i++) {\r\n\t\tvar item = array[i];\r\n\r\n\t\t// stick an index property onto the item, starting with 1, may make configurable later\r\n\t\titem.index = start +i+1;\r\n\r\n\t\t// show the inside of the block\r\n\t\tbuffer += fn(item);\r\n\t}\r\n\r\n\t// return the finished buffer\r\n\treturn buffer;\r\n\r\n});\r\n    \r\nHandlebars.registerHelper('each_with_contiguous_index', function(start, items) {\r\n    var buffer = \"\", handlebars_counter = start;\r\n    items.forEach(function(item) {\r\n        handlebars_counter++;\r\n        buffer += \"<Variable\" + handlebars_counter + \"><p>\" + item.L_QTY + \"</p></Variable\" + handlebars_counter + \">\";\r\n        handlebars_counter++;\r\n        buffer += \"<Variable\" + handlebars_counter + \"><p>\" + item.L_NAME + \"</p></Variable\" + handlebars_counter + \">\";\r\n        handlebars_counter++;\r\n        buffer += \"<Variable\" + handlebars_counter + \"><p>\" + item.L_AMT + \"</p></Variable\" + handlebars_counter + \">\";\r\n        handlebars_counter++;        \r\n        buffer += \"<Variable\" + handlebars_counter + \"><p>\" + item.L_AMT + \"</p></Variable\" + handlebars_counter + \">\";\r\n        handlebars_counter++;\r\n    });\r\n    return buffer;\r\n});\r\n</script>\r\n\r\n<script type=\"text/template\" id=\"xml_transactions_container\"><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<svg>\r\n  <variableSets>\r\n    <variableSet locked=\"none\">\r\n      <variables>\r\n        <variable varName=\"Variable0\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable1\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable2\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable3\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable4\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable5\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable6\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable7\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable8\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable9\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable10\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable11\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable12\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable13\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable14\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable15\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable16\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable17\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable20\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable21\" trait=\"textcontent\"/>   \r\n        <variable varName=\"Variable22\" trait=\"textcontent\"/>        \r\n        <variable varName=\"Variable23\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable24\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable25\" trait=\"textcontent\"/>        \r\n        <variable varName=\"Variable26\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable27\" trait=\"textcontent\"/>        \r\n        <variable varName=\"Variable28\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable29\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable30\" trait=\"textcontent\"/>        \r\n        <variable varName=\"Variable31\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable32\" trait=\"textcontent\"/>        \r\n        <variable varName=\"Variable33\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable34\" trait=\"textcontent\"/>\r\n        <variable varName=\"Variable200\" trait=\"textcontent\"/>\r\n      </variables>\r\n      \r\n         <v:sampleDataSets xmlns:v=\"casamiento\">\r\n         {{#each_with_index transactions 100}}\r\n        <v:sampleDataSet dataSetName=\"{{index}}\">\r\n         <Variable0><p>{{SHIPTONAME}}</p>\r\n         <p>{{SHIPTOSTREET}}</p>\r\n         <p>{{SHIPTOSTREET2}}</p>\r\n         <p>{{SHIPTOCITY}}</p>\r\n         <p>{{SHIPTOSTATE}}</p>\r\n         <p>{{SHIPTOZIP}}</p>\r\n         </Variable0>\r\n         \r\n         <Variable1><p>{{SHIPTONAME}}</p>\r\n         <p>{{SHIPTOSTREET}}</p>\r\n         <p>{{SHIPTOSTREET2}}</p>\r\n         <p>{{SHIPTOCITY}}</p>\r\n         <p>{{SHIPTOSTATE}}</p>\r\n         <p>{{SHIPTOZIP}}</p>\r\n         </Variable1>\r\n         \r\n         <Variable2><p>{{SHIPTONAME}}</p>\r\n         <p>{{SHIPTOSTREET}}</p>\r\n         <p>{{SHIPTOSTREET2}}</p>\r\n         <p>{{SHIPTOCITY}}</p>\r\n         <p>{{SHIPTOSTATE}}</p>\r\n         <p>{{SHIPTOZIP}}</p>\r\n         </Variable2>\r\n         <Variable3><p>{{TRANSACTIONID}}</p></Variable3>\r\n         \r\n         <Variable4><p>{{ORDERTIME}}</p></Variable4>\r\n         \r\n         <Variable5><p>{{PAYERID}}</p></Variable5>\r\n         {{#each_with_contiguous_index 19 items}}       \r\n         {{/each_with_contiguous_index}}\r\n         \r\n         <Variable200><p>{{AMT}}</p></Variable200>\r\n        </v:sampleDataSet>\r\n        {{/each_with_index}}\r\n        \r\n      </v:sampleDataSets>\r\n      </variableSet>\r\n      </variableSets>\r\n      </svg>\r\n\r\n</script>\r\n\r\n<script type=\"text/template\" id=\"table\">\r\n        <tr>\r\n            <th>Date</th>\r\n            <th>Name</th>\r\n            <th>payer ID</th>\r\n            <th>Email</th>\r\n            <th>Memo</th>\r\n            <th>Items</th>\r\n            <th>Amount</th>\r\n        </tr>\r\n</script>\r\n\r\n<script type=\"text/template\" id=\"row\">\r\n    <td>{{ORDERTIME}}</td>\r\n    <td>{{SHIPTONAME}}</td>\r\n    <td><input type=\"checkbox\" value='{{TRANSACTIONID}}' />{{TRANSACTIONID}}</td>\r\n    <td>{{email}}</td>\r\n    <td>{{note}}</td>\r\n    <td>\r\n        {{#items}}\r\n            {{L_QTY}}{{L_NAME}} {{L_AMT}} {{L_NUMBER}} {{item.L_NAME}}<br/>\r\n        {{/items}}\r\n    </td>\r\n    <td>{{amount}}</td>\r\n</script>\r\n\r\n<script type=\"text/javascript\">\r\n\r\nvar SelectedTransactions = Backbone.Collection.extend({model: Transaction});\r\nvar selected_transactions = new SelectedTransactions();\r\n\r\nvar Transaction = Backbone.Model.extend();\r\nvar Transactions = Backbone.Collection.extend({\r\n    model: Transaction,\r\n    url: '/paypalrecent'\r\n})\r\n\r\nvar transactions = new Transactions();\r\ntransactions.fetch();\r\n\r\nvar TransactionView = Backbone.View.extend({\r\n    tagName: 'tr',\r\n    events: {\r\n        'click input[type=checkbox]': 'select'\r\n    },\r\n    select: function() {\r\n        if (this.$('input[type=checkbox]').is(\":checked\")) {\r\n            selected_transactions.add(this.model);   \r\n        }\r\n        else {\r\n            selected_transactions.remove(this.model);   \r\n        }\r\n    },\r\n    initialize: function() {\r\n        this.model.bind('change', this.render, this);\r\n    },\r\n    render: function() {\r\n        var row = Handlebars.compile($('#row').html())(this.model.toJSON());\r\n        this.$el.html(row);\r\n        return this;\r\n    }\r\n})\r\n\r\nvar TransactionsView = Backbone.View.extend({\r\n    initialize: function() {\r\n        this.collection.bind('reset', this.render, this);\r\n    },\r\n    tagName: 'table',\r\n    render: function() {\r\n\r\n        this.$el.html(Handlebars.compile($('#table').html())());\r\n\r\n        var rows = []\r\n        this.collection.forEach(function(t) {\r\n            var row = new TransactionView({\r\n                model: t\r\n            }).render().el;\r\n            rows.push(row);\r\n        });\r\n        $('tr', this.$el).after(rows);\r\n        return this;\r\n    }\r\n});\r\n\r\n$(function() {\r\n    var SelectedTransactionsView = Backbone.View.extend({\r\n        el: '#download',\r\n        initialize: function() {\r\n            this.collection.bind('add', this.render, this);\r\n            this.collection.bind('remove', this.render, this);\r\n        },\r\n        render: function() {\r\n            console.log(\"rendering\");\r\n            var that = this;\r\n            var XMLTransactionsView = Handlebars.compile($('#xml_transactions_container').html())({\r\n                transactions: that.collection.toJSON()\r\n            });\r\n            this.$el.attr(\"href\", \"data:application/octet-stream,\" + encodeURIComponent(XMLTransactionsView));\r\n        }\r\n    });\r\n    var stv = new SelectedTransactionsView({\r\n        collection: selected_transactions\r\n    });\r\n    var tv = new TransactionsView({\r\n        collection: transactions\r\n    });\r\n    $('#transactions').html(tv.render().el);\r\n})\r\n\r\n</script>\r\n<style type=\"text/css\">\r\n</style>\r\n</head>\r\n\r\n<body>\r\n    <a href=\"\" download=\"names.xml\" id=\"download\">Download</a>\r\n    <div id=\"transactions\"></div>\r\n</body>\r"],[0,"\n</h"]],"start1":2,"start2":2,"length1":748,"length2":9206}]],"length":9212,"saved":false}
{"contributors":[],"silentsave":false,"ts":1351449691175,"patch":[[{"diffs":[[0,"ypal"],[-1,"recent"],[0,"'\r\n}"]],"start1":6845,"start2":6845,"length1":14,"length2":8}]],"length":9206,"saved":false}
