{"ts":1373542821505,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"module.exports = \n// Security \n\n[{\n    _id: '_design/blockAnonymousWrites',\n    language: \"javascript\",\n    validate_doc_update: function(new_doc, old_doc, userCtx) {\n        if (userCtx.name != 'casamiento') {\n            throw ({\n                forbidden: \"Not Authorized\"\n            });\n        }\n    }\n}, {\n    _id: \"_security\",\n    \"admins\": {\n        \"names\": [],\n        \"roles\": [\"admin\"]\n    },\n    \"members\": {\n        \"names\": [],\n        \"roles\": []\n    }\n},\n\n// Customers \n\n{\n    _id: '_design/customers',\n    language: \"javascript\",\n    views: {\n        by_email: {\n            map: function(doc) {\n                if (doc.type == 'Customer') {\n                    doc.emails.forEach(function(email) {\n                        emit(email, doc)\n                    });\n                }\n            }\n        },\n        email_for_customer: {\n            map: function(doc) {\n                if (doc.type == 'Customer') {\n                    doc.emails.forEach(function(email) {\n                        emit([email, 0], doc);\n                    })\n                }\n                else if (doc.type == 'email') {\n                    emit([doc.From, 1], doc);\n                }\n            }\n        },\n        by_id_and_email: {\n            map: function(doc) {\n                if (doc.type == \"Customer\") {\n                    doc.emails.forEach(function(email) {\n                        emit([doc._id, email], doc);\n                    })\n                }\n            }\n        }\n    }\n},\n\n// ALL\n{\n    _id: '_design/all',\n    language: \"javascript\",\n    views: {\n        type: {\n            map: function(doc) {\n                if (doc.type) {\n                    emit(doc.type, doc);\n                }\n            }\n        }\n    }\n},\n\n{\n    _id: '_design/products',\n    language: \"javascript\",\n    views: {\n        by_type: {\n            map: function(doc) {\n    if (doc.type && doc.type == 'product') {\n  emit(doc._id, doc)\n}\n}\n        }\n    }\n},\n{\n    _id: '_design/paypal',\n    language: \"javascript\",\n    views: {\n        by_type: {\n            reduce: function(keys, values, rereduce) {\n                return sum(values);\n            },\n            map: function(doc) {\n                emit(doc.L_TYPE, 1);\n            }\n        },\n        customers: {\n            map: function(doc) {\n                if (doc.L_AMT) {\n                    var amount = parseFloat(doc.L_AMT);\n                }\n                if (doc.L_TYPE == \"Payment\" && amount > 0) {\n                    emit(doc.L_TIMESTAMP, doc);\n                }\n            }\n        },\n        sales: {\n            map: function(doc) {\n\n                if (doc.L_AMT) {\n                    var amount = parseFloat(doc.L_AMT);\n                }\n                if ((doc.L_TYPE == \"Payment\" && amount > 0) || (doc.L_TYPE == \"Refund\" && amount < 0)) {\n                    emit(doc.L_TIMESTAMP, doc);\n                }\n            },\n        },\n        suppliers: {\n            map: function(doc) {\n                var amount;\n                var date = doc.L_TIMESTAMP.substring(0, 7)\n                if (doc.L_NAME == \"Fee\") {\n                    var card_name = \"PayPal\"\n                }\n                else if (doc.RECEIVERID) {\n                    var card_name = doc.L_NAME + \" \" + doc.RECEIVERID;\n                }\n                else {\n                    var card_name = doc.L_NAME;\n                }\n                if (doc.L_AMT) {\n                    amount = parseFloat(doc.L_AMT);\n                }\n                if (((doc.L_TYPE == \"Payment\" || doc.L_TYPE == \"Fee\" || doc.L_TYPE == \"Transfer\") && amount < 0) || (doc.L_TYPE == \"Refund\" && amount > 0)) {\n                    emit([date, card_name], {\n                        name: card_name,\n                        email: doc.L_EMAIL\n                    });\n                }\n            },\n            reduce: function(keys, values) {\n                return {\n                    email: values[0].email,\n                    name: values[0].name\n                }\n            }\n        },\n        expenses: {\n            map: function(doc) {\n                if (doc.L_NAME == \"Fee\") {\n                    var card_name = \"PayPal\"\n                }\n                else if (doc.RECEIVERID) {\n                    var card_name = doc.L_NAME + \" \" + doc.RECEIVERID;\n                }\n\n                if (doc.L_AMT) {\n                    var amount = parseFloat(doc.L_AMT);\n                }\n                var myob_account = doc.MYOB_ACCOUNT;\n                if (!myob_account) {\n                    myob_account = \"69999\"\n                }\n                if ((doc.L_TYPE == \"Payment\" || doc.L_TYPE == \"PayPal Services\" || doc.L_TYPE == \"Fee\" || doc.L_TYPE == \"Transfer\") && amount < 0) {\n                    emit(doc.L_TIMESTAMP, {\n                        name: card_name,\n                        _id: doc._id,\n                        date: doc.L_TIMESTAMP,\n                        amount: amount * -1,\n                        account: myob_account\n                    });\n                }\n                else if (doc.L_TYPE == \"Transfer\" && amount > 0) {\n                    emit(doc.L_TIMESTAMP, {\n                        name: \"Cahoot\",\n                        _id: doc._id,\n                        date: doc.L_TIMESTAMP,\n                        amount: amount,\n                        account: 12160\n                    });\n                }\n            }\n        },\n        received: {\n            map: function(doc) {\n                if (doc.L_NAME == \"Fee\" || doc.L_TYPE == \"Fee Reversal\") {\n                    var card_name = \"PayPal\"\n                }\n                else if (doc.RECEIVERID) {\n                    var card_name = doc.L_NAME + \" \" + doc.RECEIVERID;\n                }\n\n                if (doc.L_AMT) {\n                    var amount = parseFloat(doc.L_AMT);\n                }\n                var myob_account = doc.MYOB_ACCOUNT;\n                if (!myob_account) {\n                    myob_account = \"69999\"\n                }\n                if ((doc.L_TYPE == \"Reversal\" || doc.L_TYPE == \"Refund\" || doc.L_TYPE == \"Fee Reversal\") && amount > 0) {\n                    emit(doc.L_TIMESTAMP, {\n                        name: card_name,\n                        _id: doc._id,\n                        date: doc.L_TIMESTAMP,\n                        amount: amount,\n                        account: myob_account\n                    });\n                }\n            }\n        },\n        time: {\n            map: function(doc) {\n                emit(doc.L_TIMESTAMP, doc);\n            }\n        },\n        types: {\n            map: function(doc) {\n                emit([doc.L_TIMESTAMP, doc._id], [doc.L_AMT, doc.L_TYPE, doc.L_CURRENCYCODE]);\n            }\n        },\n        by_date_and_type: {\n            map: function(doc) {\n                emit([doc.L_TIMESTAMP, doc.L_TYPE], doc);\n            }\n        }\n    }\n},\n\n\n{\n    _id: '_design/customers',\n    language: \"javascript\",\n    views: {\n        ebay_messages_by_customer: {\n            map: function(doc) {\n                if (doc.type == \"Customer\") {\n                    emit([doc._id, 0], {\n                        _id: doc._id,\n                        type: doc.type,\n                        user_id: doc.UserIDs[0]\n                    });\n                }\n                else if (doc.type == \"ebay_message\") {\n                    emit([doc.customer, 1], {\n                        _id: doc._id,\n                        type: doc.type,\n                        Sender: doc.Sender,\n                        Subject: doc.Subject,\n                        Content: doc.Content\n                    });\n                }\n            }\n        }\n    }\n}]"]],"start1":0,"start2":0,"length1":0,"length2":7680}]],"length":7680}
{"contributors":[],"silentsave":false,"ts":1373542885101,"patch":[[{"diffs":[[0,"xports ="],[-1," "],[0,"\n// Secu"]],"start1":8,"start2":8,"length1":17,"length2":16},{"diffs":[[0,"tion(doc) {\n"],[1,"            "],[0,"    if (doc."]],"start1":1867,"start2":1867,"length1":24,"length2":36},{"diffs":[[0,"uct') {\n"],[1,"                  "],[0,"  emit(d"]],"start1":1928,"start2":1928,"length1":16,"length2":34},{"diffs":[[0,"d, doc)\n"],[-1,"}\n"],[1,"                }\n            "],[0,"}\n      "]],"start1":1967,"start2":1967,"length1":18,"length2":46},{"diffs":[[0,"    }\n},"],[-1,"\n"],[1," "],[0,"{\n    _i"]],"start1":2017,"start2":2017,"length1":17,"length2":17}]],"length":7737,"saved":false}
